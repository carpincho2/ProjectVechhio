<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="service.css">
    <link rel="shortcut icon" href="/logos/favicon_io/favicon.ico" type="image/x-icon">
    <title>service</title>
    <script type="module" src="./authLogic.js"></script>
</head>
<body>
    <header class="header">
  <a href="index.html"><img src="logo.png" class="logo"></a>
  <button class="hamburger" id="hamburger-btn">
    <span></span><span></span><span></span>
  </button>
  <nav class="nav-menu" id="nav-menu">
    <div class="nav-links">
      <a href="index.html">Inicio</a>
      <a href="service.html">Servicios</a>
      <a href="vehicles.html">Veh铆culos</a>
      <a href="aboutUs.html">Nosotros</a>
    </div>
    <div class="auth-links" id="auth-container">
      <a href="login.html" class="Login">Login</a>
      <a href="register.html" class="register">Register</a>
    </div>
  </nav>
</header>
    <section class="service-container">
  <h1 class="service-title">Servicio T茅cnico Oficial</h1>
  <p class="service-description">
    Cuidamos tu veh铆culo como si fuera nuestro. Nuestro equipo especializado asegura calidad, rapidez y transparencia.
  </p>

  <div class="service-grid">
    <div class="service-card">
      <h2>О Mantenimiento Preventivo</h2>
      <p>Cambio de aceite, filtros, correas, y revisi贸n general del veh铆culo.</p>
    </div>
    <div class="service-card">
      <h2> Revisi贸n Completa</h2>
      <p>Chequeo electr贸nico, diagnosis de fallas y ajustes generales.</p>
    </div>
    <div class="service-card">
      <h2> Frenos y Suspensi贸n</h2>
      <p>Revisi贸n y reemplazo de frenos, amortiguadores y alineaci贸n.</p>
    </div>
  </div>

  <div class="service-form-container">
    <h2>Solicit谩 tu turno</h2>
     <form class="service-form" id="serviceForm">
      <input type="text" id="fullName" placeholder="Nombre completo" required>
      <input type="email" id="email" placeholder="Correo" required>
      <input type="text" id="licensePlate" placeholder="Patente del veh铆culo" required>
      <select id="serviceType" required>
        <option value="" disabled selected>Selecciona tipo de servicio</option>
        <option value="Mantenimiento Preventivo">Mantenimiento Preventivo</option>
        <option value="Revisi贸n Completa">Revisi贸n Completa</option>
        <option value="Frenos y Suspensi贸n">Frenos y Suspensi贸n</option>
        <option value="Cambio de Aceite">Cambio de Aceite</option>
        <option value="Reparaci贸n General">Reparaci贸n General</option>
      </select>
      <input type="date" id="serviceDate" required>
      <input type="time" id="serviceTime" required min="09:00" max="18:00" step="1800">
      <textarea id="comments" placeholder="Comentarios opcionales"></textarea>
      <button type="submit">Pedir Turno</button>
    </form>
  </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const serviceForm = document.getElementById('serviceForm');

        serviceForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const token = localStorage.getItem('jwtToken');
            if (!token) {
                alert('Debes iniciar sesi贸n para solicitar un servicio. Ser谩s redirigido al login.');
                const returnUrl = encodeURIComponent(window.location.href);
                window.location.href = `login.html?next=${returnUrl}`;
                return;
            }

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const licensePlate = document.getElementById('licensePlate').value;
            const serviceType = document.getElementById('serviceType').value;
            const datePart = document.getElementById('serviceDate').value;
            const timePart = document.getElementById('serviceTime').value || '09:00';
            const serviceDate = `${datePart}T${timePart}:00`;
            const comments = document.getElementById('comments').value;

            try {
                // Validar que la fecha/hora sea futura
                const selectedDateTime = new Date(serviceDate);
                const now = new Date();
                if (selectedDateTime <= now) {
                    alert('Por favor, selecciona una fecha y hora futura.');
                    return;
                }

                // DEBUG: mostrar token y payload m铆nimo en consola
                console.debug('jwtToken present:', !!token);

                const response = await fetch('/api/services', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        type: serviceType,
                        date: serviceDate,
                        comments: comments
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Servicio solicitado con 茅xito!');
                    serviceForm.reset();
                } else {
                    alert(`Error al solicitar servicio: ${data.error || data.message || 'Error desconocido'}`);
                }
            } catch (error) {
                console.error('Error en la solicitud de servicio:', error);
                alert('Error de conexi贸n con el servidor.');
            }
        });
    });
</script>
    <script type="module" src="./main.js" defer></script>
    <script>
const hamburger = document.getElementById('hamburger-btn');
const navMenu = document.getElementById('nav-menu');
hamburger.addEventListener('click', () => {
  hamburger.classList.toggle('active');
  navMenu.classList.toggle('active');
});
</script>

</body>
</html>